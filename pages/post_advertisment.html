<!DOCTYPE html>
<html>
<head>
	<title>Post Advertisment</title>
  	<script type="text/javascript" src="../js/platform.js"></script>
    <script type="text/javascript">
    	var categories={"1":{"id":1,"name":"Mobiles","parent":null},"2":{"id":2,"name":"Mobile Phones","parent":1},"3":{"id":3,"name":"Samsung","parent":2},"4":{"id":4,"name":"iPhone","parent":2},"5":{"id":5,"name":"Micromax","parent":2},"6":{"id":6,"name":"Nokia","parent":2},"7":{"id":7,"name":"Sony","parent":2},"8":{"id":8,"name":"Mi","parent":2},"9":{"id":9,"name":"HTC","parent":2},"10":{"id":10,"name":"Lenovo","parent":2},"11":{"id":11,"name":"Motorola","parent":2},"12":{"id":12,"name":"Intex","parent":2},"13":{"id":13,"name":"Lava","parent":2},"14":{"id":14,"name":"LG","parent":2},"15":{"id":15,"name":"Asus","parent":2},"16":{"id":16,"name":"BlackBerry","parent":2},"17":{"id":17,"name":"Karbonn","parent":2},"18":{"id":18,"name":"Other Mobiles","parent":2},"19":{"id":19,"name":"Tablets","parent":1},"20":{"id":20,"name":"Samsung","parent":19},"21":{"id":21,"name":"iPads","parent":19},"22":{"id":22,"name":"Other Tablets","parent":19},"23":{"id":23,"name":"Accessories","parent":1},"24":{"id":24,"name":"Mobile","parent":23},"25":{"id":25,"name":"Tablets","parent":23},"26":{"id":26,"name":"Real Estate","parent":null},"27":{"id":27,"name":"For Sale","parent":26},"28":{"id":28,"name":"Apartments","parent":27},"29":{"id":29,"name":"Houses","parent":27},"30":{"id":30,"name":"Builder Floors","parent":27},"31":{"id":31,"name":"Land & Plots","parent":27},"32":{"id":32,"name":"Shops - Offices - Commercial Space","parent":27},"33":{"id":33,"name":"Farm House & Agricultural Land","parent":27},"34":{"id":34,"name":"Rent","parent":26},"35":{"id":35,"name":"Apartments","parent":34},"36":{"id":36,"name":"Houses","parent":34},"37":{"id":37,"name":"Builder Floors","parent":34},"38":{"id":38,"name":"PG & Roommates","parent":34},"39":{"id":39,"name":"Shops - Offices - Commercial Space","parent":34},"40":{"id":40,"name":"Land & Plots","parent":34},"41":{"id":41,"name":"Vacation Rentals - Guest Houses","parent":34},"42":{"id":42,"name":"Jobs","parent":null},"43":{"id":43,"name":"Data entry & Back office","parent":42},"44":{"id":44,"name":"BPO & Telecaller","parent":42},"45":{"id":45,"name":"Operator & Technician","parent":42},"46":{"id":46,"name":"Sales & Marketing","parent":42},"47":{"id":47,"name":"Cook","parent":42},"48":{"id":48,"name":"Driver","parent":42},"49":{"id":49,"name":"Hotel & Travel Executive","parent":42},"50":{"id":50,"name":"IT Engineer & Developer","parent":42},"51":{"id":51,"name":"Designer","parent":42},"52":{"id":52,"name":"Office Assistant","parent":42},"53":{"id":53,"name":"Receptionist & Front office","parent":42},"54":{"id":54,"name":"Delivery & Collection","parent":42},"55":{"id":55,"name":"Accountant","parent":42},"56":{"id":56,"name":"Teacher","parent":42},"57":{"id":57,"name":"Others","parent":42},"58":{"id":58,"name":"Bikes","parent":null},"59":{"id":59,"name":"Motorcycles","parent":58},"60":{"id":60,"name":"Bajaj","parent":59},"61":{"id":61,"name":"Hero Honda","parent":59},"62":{"id":62,"name":"Yamaha","parent":59},"63":{"id":63,"name":"Royal Enfield","parent":59},"64":{"id":64,"name":"Honda","parent":59},"65":{"id":65,"name":"Hero","parent":59},"66":{"id":66,"name":"TVS","parent":59},"67":{"id":67,"name":"Suzuki","parent":59},"68":{"id":68,"name":"KTM","parent":59},"69":{"id":69,"name":"Other Brands","parent":59},"70":{"id":70,"name":"Scooters","parent":58},"71":{"id":71,"name":"Honda","parent":70},"72":{"id":72,"name":"TVS","parent":70},"73":{"id":73,"name":"Hero","parent":70},"74":{"id":74,"name":"Suzuki","parent":70},"75":{"id":75,"name":"Bajaj","parent":70},"76":{"id":76,"name":"Mahindra","parent":70},"77":{"id":77,"name":"Other Brands","parent":70},"78":{"id":78,"name":"Bicycles","parent":58},"79":{"id":79,"name":"Hero","parent":78},"80":{"id":80,"name":"Hercules","parent":78},"81":{"id":81,"name":"Other Brands","parent":78},"82":{"id":82,"name":"Spare Parts","parent":58},"83":{"id":83,"name":"Electronics & Appliances","parent":null},"84":{"id":84,"name":"Computers & Laptops","parent":83},"85":{"id":85,"name":"TVs,  Video - Audio","parent":83},"86":{"id":86,"name":"Hard Disks, Printers & Monitors","parent":83},"87":{"id":87,"name":"ACs","parent":83},"88":{"id":88,"name":"Washing Machines","parent":83},"89":{"id":89,"name":"Fridges","parent":83},"90":{"id":90,"name":"Computer Accessories","parent":83},"91":{"id":91,"name":"Cameras & Lenses","parent":83},"92":{"id":92,"name":"Kitchen & Other Appliances","parent":83},"93":{"id":93,"name":"Games & Entertainment","parent":83},"94":{"id":94,"name":"Furniture","parent":null},"95":{"id":95,"name":"Sofa & Dining","parent":94},"96":{"id":96,"name":"Beds & Wardrobes","parent":94},"97":{"id":97,"name":"Home Decor & Garden","parent":94},"98":{"id":98,"name":"Other Household Items","parent":94},"99":{"id":99,"name":"Kids Furniture","parent":94},"100":{"id":100,"name":"Cars","parent":null},"101":{"id":101,"name":"Cars","parent":100},"102":{"id":102,"name":"Maruti Suzuki","parent":101},"103":{"id":103,"name":"Hyundai","parent":101},"104":{"id":104,"name":"Tata","parent":101},"105":{"id":105,"name":"Mahindra","parent":101},"106":{"id":106,"name":"Toyota","parent":101},"107":{"id":107,"name":"Honda","parent":101},"108":{"id":108,"name":"Chevrolet","parent":101},"109":{"id":109,"name":"Ford","parent":101},"110":{"id":110,"name":"Skoda","parent":101},"111":{"id":111,"name":"Volkswagen","parent":101},"112":{"id":112,"name":"Fiat","parent":101},"113":{"id":113,"name":"Nissan","parent":101},"114":{"id":114,"name":"Renault","parent":101},"115":{"id":115,"name":"Mitsubishi","parent":101},"116":{"id":116,"name":"Mercedes-Benz","parent":101},"117":{"id":117,"name":"Audi","parent":101},"118":{"id":118,"name":"Mahindra Renault","parent":101},"119":{"id":119,"name":"BMW","parent":101},"120":{"id":120,"name":"Hindustan Motors","parent":101},"121":{"id":121,"name":"Other Brands","parent":101},"122":{"id":122,"name":"Commercial Vehicles","parent":100},"123":{"id":123,"name":"Other Vehicles","parent":100},"124":{"id":124,"name":"Spare Parts","parent":100},"125":{"id":125,"name":"Books, Sports & Hobbies","parent":null},"126":{"id":126,"name":"Books","parent":125},"127":{"id":127,"name":"Musical Instruments","parent":125},"128":{"id":128,"name":"Sports Equipment","parent":125},"129":{"id":129,"name":"Gym & Fitness","parent":125},"130":{"id":130,"name":"Other Hobbies","parent":125},"131":{"id":131,"name":"Fashion","parent":null},"132":{"id":132,"name":"Men","parent":131},"133":{"id":133,"name":"Women","parent":131},"134":{"id":134,"name":"Kids","parent":131},"135":{"id":135,"name":"Pets","parent":null},"136":{"id":136,"name":"Fishes & Aquarium","parent":135},"137":{"id":137,"name":"Dogs","parent":135},"138":{"id":138,"name":"Other Pets","parent":135},"139":{"id":139,"name":"Pet Food & Accessories","parent":135},"140":{"id":140,"name":"Services","parent":null},"141":{"id":141,"name":"Drivers & Taxi","parent":140},"142":{"id":142,"name":"Education & Classes","parent":140},"143":{"id":143,"name":"Electronics & Computer","parent":140},"144":{"id":144,"name":"Health & Beauty","parent":140},"145":{"id":145,"name":"Other Services","parent":140}};
    	var search={};
    	var selected=null;
      function initPage(){
			selectCategory(null);        
			command("showMenuIcons?search");
			selectStep(1);
      }

      function searchTextChange(query){
      		setTimeout(function(){searchCategory(query)},0);
      }


      function selectCategory(cat){
      	selected=cat;
      	searchTextChange('');
      	var tree=getCategoryTree(cat,true);
      	if(cat){
	      	tree.splice(0,0,{name:'Categories',id:null});
	      	$.each(tree,function(key,item){
	      		item.link="javascript:selectCategory("+item.id+")";
	      	});
	      	renderTemplate({items:tree},"#selected_category","breadcrumb");
      	}else{
      		$("#selected_category").html("<h2>Please select a Category</h2>");
      	}
      }

      function selectStep(step){
      	switch(step){
      		case 1:
      		$("#categories_view").slideDown();
      		$("#details_view").slideUp();
      		break;
      		case 2:
      		$("#categories_view").slideUp();
      		$("#details_view").slideDown();
      		break;
      	}
      }

      

      function searchCategory(query){
      	if(query.length<2 && query.length>0)
      		return;
      	var q = new RegExp(query, "i")
      	if(!search[query] && query.length>0){
      		var match=[];
	      	$.each(categories,function(key,value){
	      		if(q.test(value.name)) {
	      			match.push(key);
	      		}
	      	});
	      	search[query]=match;
      }else if(query.length==0){
      		var match=[];
	      	$.each(categories,function(key,value){
	      		if(value.parent==selected) {
	      			match.push(key);
	      		}
	      	});
	      	search[query]=match;
      }

      	var trees=[];
      	$.each(search[query],function(key,value){
      		trees.push({leafID:value, tree:getCategoryTree(value)});
      	});

      	var treeInsideSelected=filterInsideSelected(trees);

      	if(treeInsideSelected.length==0 && query.length==0)
			selectStep(2);

      	renderTemplate({categories:treeInsideSelected},"#categories","categories_list");
      }

      function filterInsideSelected(list){
      	if(!selected)
      		return list;
      	var newList=[];
      	$.each(list,function(key,item){
      		var inParent=false;
      		$.each(item.tree,function(nodeKey,node){
      			if(node.parent==selected){
      				item.tree.splice(0,nodeKey);
      				inParent=true;
      			}
      		});
      		if(inParent)
      			newList.push(item);
      			
      	});

      	return newList;

      }

      function getCategoryTree(index,full){
      	var curentNode=index;
      	var tree=[];
      	while(curentNode && (curentNode != selected || full)){ 
      		var node=categories[curentNode];
      		tree.push(node);
      		curentNode=node.parent
      	}
      	return tree.reverse();
      }

      function selectImage(){
        	var file=$("<input type='file' style='display:none;' accept='image/*' />");
        	$("body").append(file);
        	
        	file.on("change",function(){
        		readURL(this);
        	});
        	file.click();
        }

        function readURL(input) {
		    if (input.files && input.files[0]) {
		        var reader = new FileReader();
		        reader.onload = function (e) {
		            $('<img src="'+e.target.result+'" />').insertBefore("#add_image_button");
		        }
		        reader.readAsDataURL(input.files[0]);
		    }
		}

    </script>
</head>
<body>

	<div class="views">
        <div class="view view-mai" id="categories_view">
          <div class="pages">
            <div class="page" data-page="home">
            	<div class="page-content">
            		<div id="selected_category"></div>
					<div id="categories" style="margin-top: 0;" class="list-block"></div>
		     	</div>
	      	</div>
	      </div>
	    </div>
	    <div class="view view-main" id="details_view" style="display:none;">
	    	<div class="page" data-page="sample">
            	<div class="page-content">

            	<div class="content-block-title">Advertisment Title</div>
				<div class="list-block">
				  <ul>
				    <li>
				      <div class="item-content">
				        <div class="item-inner">
				          <div class="item-input">
				            <input type="text" placeholder="Advertisment Title">
				          </div>
				        </div>
				      </div>
				    </li>
				  </ul>
				</div> 

				<div class="content-block-title">Description</div>
				<div class="list-block">
				  <ul>
				    <li>
				      <div class="item-content">
				        <div class="item-inner">
				          <div class="item-input">
				            <textarea placeholder="Description"></textarea>
				          </div>
				        </div>
				      </div>
				    </li>
				  </ul>
				</div> 

            	<div id="upload_images">
            		<section id="uploaded_images">
            			<img src="/images/add_image.png" id="add_image_button" onClick="selectImage()"/>
            		</section>
            		
            			
            		
            	</div>
		     	</div>
	      	</div>
	    </div>

	    </div>
	 </div>
</body>
</html>