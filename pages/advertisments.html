<!DOCTYPE html>
<html>
  <head>
  	<title>ADVERTISMENTS</title>
  	<script type="text/javascript" src="../js/platform.js"></script>
    <script type="text/javascript" src="../js/categories.js"></script>
    <script type="text/javascript">
    var socket;
    var token;
    var category=params.category;
    var query=params.query;
    if(category)document.title=categories[category].name;
    function initPage(){
      command("showMenuIcons?search");
      OneApp.getValue(['access_token'],function(resp){
        token=resp.access_token;
      });
      fetchAds();        
    }

    function searchQuery(q){
      query=q;
      fetchAds();
    }

    function fetchAds(){
        $.ajax({
        url:apiBaseUrl+"/advertisment",
        data:{category:category,query:query},
        dataType:"json",
        success:function(response){
          renderTemplate({advertisments:response.data},"#content","advertismentList");
        },
        error:function(error){renderTemplate({},"#content","no_connection")},
        beforeSend: function (xhr) {xhr.setRequestHeader('Authorization', "Bearer "+token);}
      });
    }
    </script>
  </head>
  <body>
    <div class="views">
        <div class="view view-main">
          <div class="pages">
            <div class="page" data-page="home">
              <div id="content" class="page-content">                
              </div>
            </div>
          </div>
        </div>
      </div>
  </body>
</html>