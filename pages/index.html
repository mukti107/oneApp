<!DOCTYPE html>
<html>
<head>
	<title>Home</title>

	<script type="text/javascript" src="../js/platform.js"></script>
	<script type="text/javascript">
		enableNavBar="NO";

	function initPage(){
		getUserToken();
		loadMenu();
	}

	function loadMenu(){
		$.ajax({url:"/menu.json",
			success:function(menu){
				console.log(menu);
				var m = JSON.parse(menu);
				renderTemplate({items:m},"#content","home_menu");
			},error:function(e){
				console.log(e)
			}
		});
	}


	function onReceiveUserToken(token){
		if(token.length){
			$.ajax({
				url:apiBaseUrl+"/me",
				dataType:"json",
				success:function(response){
					response.logged=true;
					renderTemplate(response,"#user_info","user_info")
				},
				error:function(err,stat,resp){
					//renderTemplate({name:"Guest"},"#user_info","user_info")
					if(err.status==401)
						renderTemplate({logged:false},"#user_info","user_info")
					console.log(err);
				},
				beforeSend: function (xhr) {
			        xhr.setRequestHeader('Authorization', "Bearer "+token);
			    }
			});
		}else{
			renderTemplate({logged:false},"#user_info","user_info")
		}
	}


	function facebookLogin(token){
		$.ajax({
			url:apiBaseUrl+"/login",
			method:"GET",
			data:{fb_token:token},
			dataType:"json",
			success:function(resp){
				onReceiveUserToken(resp.access_token);
				command("saveValues?access_token="+resp.access_token+"&refresh_token="+resp.refresh_token);
			},
			error:function(err){
				//if(err.rea)
				//alert("Error logging in");
			},
			beforeSend:function(){command("showProgress");},
	        complete:function(xhr){command("dismissProgress");}
		});
	}

	</script>
</head>
<body class="">

	<!-- <h1 id="user_info"></h1> -->

	<div class="views">
        <div class="view view-main">
          <div class="pages">
            <div class="page" data-page="home">
              <div  class="page-content landing_page_bg">
              <div class="row landing_page_title_bar">
              	<a href="oneapp://toggleMenu"><img src="/icons/menu.png" class="menu_icon" /></a>

              	<div id="user_info" style="margin-top:5px">
              	</div>
              	
              </div>
              <div id="content"></div>
              		

              </div>
            </div>
          </div>
        </div>
      </div>

	

</body>
</html>