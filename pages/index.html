<!DOCTYPE html>
<html>
<head>
	<title>Home</title>

	<script type="text/javascript" src="../js/platform.js"></script>
	<script type="text/javascript">
		enableNavBar="NO";

	function initPage(){
		getUserToken();
	}


	function onReceiveUserToken(token){
		if(token.length){
			$.ajax({
				url:apiBaseUrl+"/user",
				dataType:"json",
				success:function(response){
					renderTemplate(response,"#user_info","user_info")
				},
				error:function(err,stat,resp){
					renderTemplate({name:"Guest"},"#user_info","user_info")
				},
				beforeSend: function (xhr) {
			        xhr.setRequestHeader('Authorization', "Bearer "+token);
			    }
			});
		}
	}


	function facebookLogin(token){
		$.ajax({
			url:apiBaseUrl+"/login",
			method:"GET",
			data:{fb_token:token},
			dataType:"json",
			success:function(resp){
				onReceiveUserToken(resp.access_token);
				command("saveValues?access_token="+resp.access_token+"&refresh_token="+resp.refresh_token);
			},
			error:function(err){
				alert("Error logging in");
			},
			beforeSend:function(){command("showProgress");},
	        complete:function(xhr){command("dismissProgress");}
		});
	}

	</script>
</head>
<body>
	<h1 id="user_info"></h1>

	<div>
		<a href="oneapp://toggleMenu"><i class="icon f7-icons">bars</i></a>
		<a href="oneapp://facebookLogin">Login With Facebook</a><br/>
		<a href="oneapp://rechargeCardScanner">Scanner</a>
	</div>

</body>
</html>