<!DOCTYPE html>
<html>
<head>
	<title>Home</title>
	<meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
	<script type="text/javascript" src="../js/platform.js"></script>
	<script type="text/javascript">
		enableNavBar="NO";

	function initPage(){
		getUserToken();
		var date=new Date();
		var bs_date=eng_to_nep(date.getFullYear(),date.getMonth()+1,date.getDate());
		console.log(date.getFullYear(),date.getMonth()+1,date.getDate());
		renderTemplate({date:[getNepaliDateInfo(bs_date)]},"#nepali_date","date_details")

		start();
	}

	function start(){
	    var time = new Date()
	    var hours = time.getHours()
	    var minutes = time.getMinutes()
	    minutes=((minutes < 10) ? "0" : "") + minutes
	    var seconds = time.getSeconds()
	    seconds=((seconds < 10) ? "0" : "") + seconds
	    var clock = hours + ":" + minutes + ":" + seconds
	    $("#nepali_time").html(num_to_nepali(clock));
	    timer = setTimeout("start()",1000)
	}

	

	function loadMenu(){
		$.ajax({url:"/menu.json",
			success:function(menu){
				var m = JSON.parse(menu);
				renderTemplate({items:m},"#content","home_menu");
			},error:function(e){
				console.log(e)
			}
		});
	}


	function onReceiveUserToken(token){
		if(token.length){
			$.ajax({
				url:apiBaseUrl+"/me",
				dataType:"json",
				success:function(response){
					response.logged=true;
					renderTemplate(response,"#user_info","user_info")
				},
				error:function(err,stat,resp){
					//renderTemplate({name:"Guest"},"#user_info","user_info")
					if(err.status==401)
						renderTemplate({logged:false},"#user_info","user_info")
					console.log(err);
				},
				beforeSend: function (xhr) {
			        xhr.setRequestHeader('Authorization', "Bearer "+token);
			    }
			});
		}else{
			renderTemplate({logged:false},"#user_info","user_info")
		}
	}


	function facebookLogin(token){
		$.ajax({
			url:apiBaseUrl+"/login",
			method:"GET",
			data:{fb_token:token},
			dataType:"json",
			success:function(resp){
				onReceiveUserToken(resp.access_token);
				command("saveValues?access_token="+resp.access_token+"&refresh_token="+resp.refresh_token);
			},
			error:function(err){
				//if(err.rea)
				//alert("Error logging in");
			},
			beforeSend:function(){command("showProgress");},
	        complete:function(xhr){command("dismissProgress");}
		});
	}

	</script>
</head>
<body class="">

	<!-- <h1 id="user_info"></h1> -->

	<div class="views">
        <div class="view view-main">
          <div class="pages">
            <div class="page" data-page="home">
              <div  class="page-content landing_page_bg">
              <div class="row landing_page_title_bar">
              	<a href="oneapp://toggleMenu"><img src="/icons/menu.png" class="menu_icon" /></a>

              	<div id="user_info" style="margin-top:5px">
              	</div>
              	
              </div>
              <div id="content">
              	<div class="row no-gutter">
					<div class="col-50 home_menu_item text-center weather tile" style="position:relative;background-color:{{bgColor}};">
						<div class="absolute-center">
							{{name}}
						</div>
					</div>
					<div class="col-50 home_menu_item text-center date_time tile" style="position:relative;background-color:{{bgColor}};">
						<div class="absolute-center">
						<a href="#" style="padding:15px 0 15px 0;color:#fff;">
							<h1 id="nepali_time"></h1>
							<span id="nepali_date"></span>

						</a>
						</div>
					</div>
					<div class="col-50 home_menu_item text-center news tile" style="position:relative;background-color:{{bgColor}};">
						<div class="absolute-center">
						<a href="#" style="padding:15px 0 15px 0;color:#fff;">
							<i class="icon f7-icons">{{icon}}</i><br/>
							{{name}}
						</a>
						</div>
					</div>
              </div>
              		

              </div>
            </div>
          </div>
        </div>
      </div>

	

</body>
</html>