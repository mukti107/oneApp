<!DOCTYPE html>
<html>
  <head>
  	<title>ADVERTISMENTS</title>
  	<script type="text/javascript" src="../js/platform.js"></script>
    

    <script type="text/javascript">
    var token;
    function initPage(){
      getUserToken();
      fetchAd();        
    }

    function onReceiveUserToken(user_token){
      token=user_token;
    }

    function fetchAd(){
        $.ajax({
        url:apiBaseUrl+"/advertisment/"+params["id"],
        dataType:"json",
        success:function(response){
          renderTemplate(response,"#advertisment","advertismentDetails");
          if(response.isOwner){
            $("#startchat").hide()
          }else{
            $("#startchat").show()
          }
        },
        error:function(error){},
        beforeSend: function (xhr) {xhr.setRequestHeader('Authorization', "Bearer "+token);}
      });
  }


  function startChat(){
      $.ajax({
        url:apiBaseUrl+"/advertisment/startchat/"+params['id'],
        dataType:"json",
        success:function(response){
          window.location.replace(ROOT_DIR+"pages/conversation.html?id="+response.chat_id+"&user="+response.user_id+"_newPage");
        },
        error:function(error){
          if(error.status==401){
            command("alert?message="+encodeURIComponent("Please login to start chatting..."));
            command("facebookLogin");
          }
        },
        beforeSend: function (xhr) {xhr.setRequestHeader('Authorization', "Bearer "+token);}
      }
      ); 
  }

   

    

    </script>
  </head>
  <body>
    <div class="views">
        <div class="view view-main">
          <div class="pages">
            <div class="page" data-page="home">
              <div style="display: none;" id="startChat" class="toolbar toolbar-bottom theme-bg">
                <div onclick="startChat(params['id'])"  class="toolbar-inner" style="justify-content: center;">
                  <a href="#" class="link text-white">TALK WITH ADVERTISER</a>
                </div>
              </div>
              <div id="content" class="page-content">                
                <div class="list-block" id="advertisment"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </body>
</html>